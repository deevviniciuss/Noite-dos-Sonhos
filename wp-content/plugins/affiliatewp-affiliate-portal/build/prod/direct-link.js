window.AFFWP=window.AFFWP||{},window.AFFWP.portal=window.AFFWP.portal||{},window.AFFWP.portal.directLink=function(t){var r={};function n(e){if(r[e])return r[e].exports;var i=r[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=r,n.d=function(t,r,e){n.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:e})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,r){if(1&r&&(t=n(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(n.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var i in t)n.d(e,i,function(r){return t[r]}.bind(null,i));return e},n.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(r,"a",r),r},n.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},n.p="",n(n.s=39)}({0:function(t,r){!function(){t.exports=this.regeneratorRuntime}()},1:function(t,r){!function(){t.exports=this.wp.url}()},2:function(t,r){function n(t,r,n,e,i,o,a){try{var u=t[o](a),c=u.value}catch(t){return void n(t)}u.done?r(c):Promise.resolve(c).then(e,i)}t.exports=function(t){return function(){var r=this,e=arguments;return new Promise((function(i,o){var a=t.apply(r,e);function u(t){n(a,i,o,u,c,"next",t)}function c(t){n(a,i,o,u,c,"throw",t)}u(void 0)}))}}},3:function(t,r,n){"use strict";function e(t){return new Promise((function(r){return setTimeout(r,t)}))}function i(t){return"string"!=typeof t||t.endsWith("/")?t:"".concat(t,"/")}n.d(r,"a",(function(){return e})),n.d(r,"b",(function(){return i}))},39:function(t,r,n){"use strict";n.r(r);var e=n(0),i=n.n(e),o=n(2),a=n.n(o),u=n(8);r.default=function(){return{isLoading:!0,valid:!0,links:[],maxLinks:0,notices:"",showingSuccessMessage:!1,showUpdateNotice:!1,isDismissingNotice:!1,init:function(){var t=this;return a()(i.a.mark((function r(){var n;return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,AFFWP.portal.core.fetch({path:"affwp/v2/portal/integrations/direct-link-tracking/get-links",cacheResult:!1});case 2:n=r.sent,t.links=n.links.map((function(t){return t.timer=!1,t.isValidatingUrl=!1,t.isRemoving=!1,t})),t.notices=n.notices,0===t.links.length&&(t.addDomain(),t.valid=!1),t.isLoading=!1;case 7:case"end":return r.stop()}}),r)})))()},addDomain:function(){this.links.length+1<=this.maxLinks&&(this.links.push({url_id:"",url:"",errors:{}}),this.valid=!1)},getLinkObject:function(t){return void 0!==this.links[t]&&this.links[t]},getLinkParam:function(t,r){var n=this.getLinkObject(t);return!1===n||void 0===n[r]?"":n[r]},removeLink:function(t){var r=this;return a()(i.a.mark((function n(){var e,o;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e=r.getLinkObject(t),!(o=e.url_id)){n.next=6;break}return e.isRemoving=!0,n.next=6,AFFWP.portal.core.fetch({path:"affwp/v2/portal/integrations/direct-link-tracking/links/".concat(o),method:"DELETE",data:{}});case 6:r.links.splice(t,1);case 7:case"end":return n.stop()}}),n)})))()},submit:function(){var t=this;return a()(i.a.mark((function r(){var n;return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.valid){r.next=2;break}return r.abrupt("return");case 2:return t.isLoading=!0,r.next=5,AFFWP.portal.core.fetch({path:"affwp/v2/portal/integrations/direct-link-tracking/save-links",method:"POST",data:{links:t.links}});case 5:n=r.sent,t.links=n.links,t.notices=n.notices,t.showUpdateNotice=!0,t.isLoading=!1;case 10:case"end":return r.stop()}}),r)})))()},dismiss:function(t){var r=this;return a()(i.a.mark((function n(){return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!r.isDismissingNotice){n.next=2;break}return n.abrupt("return");case 2:return r.isDismissingNotice=!0,r.isLoading=!0,n.next=6,AFFWP.portal.core.fetch({path:"affwp/v2/portal/integrations/direct-link-tracking/dismiss-notice",method:"POST",data:{url_id:t}});case 6:r.init();case 7:case"end":return n.stop()}}),n)})))()},hasError:function(t,r){return t.errors&&!0===t.errors[r]},hasErrors:function(t){return t.errors&&Object.keys(t.errors).length>0},checkValid:function(){var t=!0;this.links.find((function(t){return t.errors&&Object.keys(t.errors).length>0}))&&(t=!1),this.valid=t},validateFrontend:function(t){var r=this.getLinkObject(t);if(!1!==r){var n=r.url;clearTimeout(r.timer);var e=!1;if(r.errors=[],""===n.trim())r.errors.empty=!0,e=!0;else this.links.find((function(r,e){return e!==t&&r.url===n}))&&(r.errors.duplicated=!0,e=!0),Object(u.g)(n)||(r.errors.invalid=!0,e=!0);e?this.checkValid():(this.valid=!1,r.timer=setTimeout(this.validateBackend.bind(this,t),500))}},validateBackend:function(t){var r=this;return a()(i.a.mark((function n(){var e,o,a;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!1!==(e=r.getLinkObject(t))){n.next=3;break}return n.abrupt("return");case 3:return o=e.url,e.isValidatingUrl=!0,n.next=7,AFFWP.portal.core.fetch({path:"affwp/v2/portal/integrations/direct-link-tracking/validate",method:"POST",data:{url:o}});case 7:if(a=n.sent,e.isValidatingUrl=!1,o===e.url){n.next=11;break}return n.abrupt("return");case 11:a.success||(e.errors.addon=!0,e.errors.addonReason=a.error),r.checkValid();case 13:case"end":return n.stop()}}),n)})))()}}}},8:function(t,r,n){"use strict";n.d(r,"f",(function(){return l})),n.d(r,"c",(function(){return f})),n.d(r,"a",(function(){return a})),n.d(r,"b",(function(){return c})),n.d(r,"e",(function(){return s})),n.d(r,"g",(function(){return d})),n.d(r,"d",(function(){return p}));var e=n(1),i=n(3),o=/\/([^\/a-zA-Z-_]+)\/?$/;function a(t,r){return r.startsWith("/")&&(r=r.substr(1)),u(t,["protocol","authority","path",Object(i.b)(r),"querystring","fragment"])}function u(t,r){var n={getProtocol:function(){return"".concat(Object(e.getProtocol)(t),"//")},getAuthority:function(){return Object(i.b)(Object(e.getAuthority)(t))},getPath:function(){return Object(i.b)(Object(e.getPath)(t))},getQuerystring:function(){return Object(e.getQueryString)(t)?"?".concat(Object(e.getQueryString)(t)):""},getFragment:function(){return Object(e.getFragment)(t)}};return r.reduce((function(t,r){var e=["protocol","authority","path","querystring","fragment"].includes(r.toLowerCase());if(!e&&"string"==typeof r)return t+r;if(!e)return t;var i=(0,n["get"+r.charAt(0).toUpperCase()+r.slice(1).toLowerCase()])();return void 0===i?t:t+i}),"")}function c(t,r){var n=Object(e.getAuthority)(t);return n===r||new RegExp("\\w\\."+r+"$").test(n)}function s(t){var r=Object(e.getProtocol)(t);return["https:","http:"].includes(r)}function f(t){var r=Object(e.getPath)(t).match(o);return null===r?"1":r[1]}function l(t,r){f(t);var n=["protocol","authority",Object(i.b)(Object(e.getPath)(t)).replace(o,"/")];r.page&&(r.page>1&&n.push(r.page+"/"),delete r.page);var a=u(t,n);return Object(e.addQueryArgs)(a,r)}function d(t){return/\.\w\w.*/.test(t)}function p(t){var r=t.split("?"),n=r[1],e=r[0];return n?e+"?"+n.split("&").map((function(t){return t.split("=")})).sort((function(t,r){return t[0].localeCompare(r[0])})).map((function(t){return t.join("=")})).join("&"):e}}});